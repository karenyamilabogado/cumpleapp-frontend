<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>CumpleaÃ±os App</title>
</head>
<body>
  <h1>Lista de CumpleaÃ±os ğŸ‰ğŸ’</h1>

  <!-- Formulario para agregar cumpleaÃ±os -->
  <form id="formCumple">
    <input type="text" id="nombre" name="nombre" placeholder="Nombre" required />
    <input type="date" id="fecha" name="fecha" required />
    <button type="submit">Guardar</button>
  </form>

  <!-- Lista de cumpleaÃ±os -->
  <h2>Lista de cumpleaÃ±os</h2>
  <ul id="listaCumples"></ul>

  <!-- Script -->
  <script>
    const API_BASE = "http://localhost:3001";

    // ğŸ‘‰ FunciÃ³n para cargar y mostrar los cumpleaÃ±os guardados
    async function cargarCumples() {
      try {
        const res = await fetch(`${API_BASE}/cumples`);
        const data = await res.json();
        const lista = document.getElementById("listaCumples");
        lista.innerHTML = "";
        data.forEach(c => {
          const li = document.createElement("li");
          const fechaFormateada = new Date(c.fecha).toLocaleDateString("es-ES", {
            year: "numeric",
            month: "long",
            day: "numeric"
          });
          li.textContent = `${c.nombre} â€” ${fechaFormateada}`;
          lista.appendChild(li);
        });
      } catch (error) {
        console.error("Error al cargar cumpleaÃ±os:", error);
      }
    }

    // ğŸ‘‰ Manejar envÃ­o del formulario
    document.getElementById("formCumple").addEventListener("submit", async (e) => {
      e.preventDefault();
      const nombre = document.getElementById("nombre").value.trim();
      const fecha = document.getElementById("fecha").value;

      if (!nombre || !fecha) {
        alert("Por favor completa todos los campos");
        return;
      }

      try {
        const res = await fetch(`${API_BASE}/save`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ nombre, fecha })
        });

        const data = await res.json();
        alert(data.mensaje || data.error);

        if (res.ok) {
          cargarCumples();
          document.getElementById("formCumple").reset();
        }
      } catch (error) {
        console.error("Error al guardar cumpleaÃ±os:", error);
        alert("Error al guardar");
      }
    });

    // ğŸ‘‰ Cargar lista al inicio
    cargarCumples();
  </script>
</body>
</html>