<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Cumplea√±os App</title>
</head>
<body>
  <h1>Lista de Cumplea√±os üéâüêí</h1>

  <!-- Formulario para agregar cumplea√±os -->
  <form id="formCumple">
    <input type="text" id="nombre" name="nombre" placeholder="Nombre" required />
    <input type="date" id="fecha" name="fecha" required />
    <button type="submit">Guardar</button>
  </form>

  <!-- Lista de cumplea√±os -->
  <h2>Lista de cumplea√±os</h2>
  <ul id="listaCumples"></ul>

  <!-- Script -->
  <script>
    const API_BASE = "https://cumpleapp-backend.onrender.com";

    // üëâ Funci√≥n para cargar y mostrar los cumplea√±os guardados
    async function cargarCumples() {
      try {
        const res = await fetch(`${API_BASE}/cumples`);
        const data = await res.json();
        const lista = document.getElementById("listaCumples");
        lista.innerHTML = "";
        data.forEach(c => {
          const li = document.createElement("li");
          const fechaFormateada = new Date(c.fecha).toLocaleDateString("es-ES", {
            year: "numeric",
            month: "long",
            day: "numeric"
          });
          li.textContent = `${c.nombre} ‚Äî ${fechaFormateada}`;
          lista.appendChild(li);
        });
      } catch (error) {
        console.error("Error al cargar cumplea√±os:", error);
      }
    }

    // üëâ Manejar env√≠o del formulario
    document.getElementById("formCumple").addEventListener("submit", async (e) => {
      e.preventDefault();
      const nombre = document.getElementById("nombre").value.trim();
      const fecha = document.getElementById("fecha").value;

      if (!nombre || !fecha) {
        alert("Por favor completa todos los campos");
        return;
      }

      try {
        const res = await fetch(`${API_BASE}/save`, {   // ‚úÖ CORRECTO
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ nombre, fecha })
        });

        const data = await res.json();
        if (res.ok) {
          alert(data.mensaje);
          cargarCumples();
          document.getElementById("formCumple").reset();
        } else {
          alert(data.error || "Error al guardar");
        }
      } catch (error) {
        console.error("Error al guardar cumplea√±os:", error);
        alert("Error al guardar");
      }
    });

    // üëâ Cargar lista al inicio
    cargarCumples();
  </script>
</body>
</html>
